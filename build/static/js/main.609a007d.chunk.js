(this.webpackJsonpjoust=this.webpackJsonpjoust||[]).push([[0],{125:function(e,t,n){e.exports=n(136)},130:function(e,t,n){},131:function(e,t,n){e.exports=n.p+"static/media/logo.25bf045c.svg"},132:function(e,t,n){},136:function(e,t,n){"use strict";n.r(t);var i=n(42),o=n.n(i),r=n(117),a=n.n(r),s=(n(130),n(131),n(132),n(81)),l=n(82),c=n(88),h=n(83),p=n(64),u=n(89),g=n(84),y=n(16),v=n(0),f=n(123),m=n(118),d=n(99),w=n(119),k=n(67),I=(n(133),n(63)),b=n(69),x=n(100),M=(n(137),n(12)),D=n(61),W=n(120),C=n(101),S=n(121),A=n(52),L=n(15),B=n(124),P=(n(116),n(134),n(14)),q=n(23),O=(n(135),n(122)),z=n.n(O);window.earcut=z.a;var E=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).onResizeWindow=function(){n.engine&&n.engine.resize()},n.onCanvasLoaded=function(e){if(null!==e){n.canvas=e;var t=function(e){return e.preventDefault()};n.canvas.onwheel=t,n.canvas.onmousewheel=t,n.canvas.focus()}},n.onKeyDown=function(e){n.props.onKeyDown(e)},n.onKeyUp=function(e){n.props.onKeyUp(e)},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.engine=new P.a(this.canvas,this.props.antialias,this.props.engineOptions,this.props.adaptToDeviceRatio),this.scene=new q.a(this.engine),this.props.onSceneMount({scene:this.scene,engine:this.engine,canvas:this.canvas}),this.engine.runRenderLoop((function(){e.scene&&(e.props.onRender(),e.scene.render())})),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow)}},{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.onCanvasLoaded,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,style:{width:"100%",height:"100%",outline:"none"}})}}]),t}(o.a.Component);E.defaultProps={antialias:!0,adaptToDeviceRatio:!1};var _=E,R=!1,T=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(h.a)(t).call(this,e))).onSceneMount=function(e){var t=e.canvas,i=e.scene;e.engine;window.scene=i,n.scene=i;var o=new v.q(0,-9.81,0),r=new g.a;i.enablePhysics(o,r),n.camera=n.createCamera(i,t),n.createSky(i),n.createDirectionalLight(i),n.createHemisphericLight(i),n.createStaticMesh({scene:i}),R&&n.showWorldAxis({size:5,scene:i})},n.createStaticMesh=function(e){var t=e.scene;n.loadModels(t),n.concreteMaterial=n.createConcreteMaterial(t),n.pbr=n.createBricksMaterial(t),n.land=n.createGround(t),n.createFloor(t),n.ceiling=n.createCeiling(t),n.createLeftWall(t),n.createRightWall(t),n.createBackWall(t),n.createFrontWall(t),n.platform=n.createPlatform(t),n.egg=n.createEgg(t),n.player=n.createSphere(t)},n.onSphereHitEgg=function(e,t){n.egg.physicsImpostor.dispose(),n.egg.parent=n.player,n.egg.position=new v.q(1.75,0,0)},n.onSphereHitGround=function(e,t){n.changeModel(n.walking),Math.abs(n.player.physicsImpostor.getLinearVelocity().y)<4&&(n.touching=!0)},n.onSpacePressed=function(){n.changeModel(n.flapping);var e=n.getBoost();console.log("spacebar boost"+e),n.player.physicsImpostor.applyImpulse(new v.q(.7*n.keyDirection*e,1,0),n.player.getAbsolutePosition()),n.resetPosAndAngle(),n.touching=!1},n.onKeyDown=function(e){if(e.preventDefault()," "===e.key)n.onSpacePressed();else if("ArrowRight"===e.key){if(n.keyDirection=1,n.rotatePlayer(n.keyDirection),n.player.physicsImpostor.friction=.1,n.land.physicsImpostor.friction=.1,!n.accelerateInterval){var t=Object(p.a)(n);n.accelerateInterval=setInterval((function(){t.accelerate.apply(t)}),200)}}else if("ArrowLeft"===e.key){if(n.keyDirection=-1,n.rotatePlayer(n.keyDirection),n.player.physicsImpostor.friction=.1,n.land.physicsImpostor.friction=.1,!n.accelerateInterval){var i=Object(p.a)(n);n.accelerateInterval=setInterval((function(){i.accelerate.apply(i)}),200)}}else if("AltGraph"===e.key&&n.player.getChildren().includes(n.egg)){console.log("AltGraph"),n.egg.parent=null,n.egg.position=n.player.getAbsolutePosition(),n.egg.position.x+=5*n.keyDirection,n.setEggImpostor(),n.egg.position.z=0;var o=n.egg.physicsImpostor.getLinearVelocity();o.z=0,n.egg.physicsImpostor.setLinearVelocity(o),n.egg.physicsImpostor.setAngularVelocity(new v.q(0,0,0)),n.egg.rotation=new v.q(0,0,0),n.egg.physicsImpostor.applyImpulse(new v.q(20*n.keyDirection,0,0),n.egg.getAbsolutePosition())}},n.onKeyUp=function(e){e.preventDefault(),"ArrowRight"===e.key||"ArrowLeft"===e.key?(n.keyDirection=0,n.accelerateInterval&&(console.log("clearInterval"),clearInterval(n.accelerateInterval),n.accelerateInterval=null),n.player.physicsImpostor.friction=1,n.land.physicsImpostor.friction=1):" "===e.key&&n.changeModel(n.flying)},n.resetPosAndAngle=function(){if(n.player&&n.player.physicsImpostor){var e=n.player.physicsImpostor.getLinearVelocity();e.z=0,n.player.physicsImpostor.setLinearVelocity(e),n.player.position.z=0,n.player.physicsImpostor.setAngularVelocity(new v.q(0,0,0)),n.player.rotation=new v.q(0,0,0)}},n.showWorldAxis=function(e){var t=e.size,n=e.scene;D.a.CreateLines("axisX",{points:[v.q.Zero(),new v.q(t,0,0)]},n).color=new v.c(1,0,0),D.a.CreateLines("axisY",{points:[v.q.Zero(),new v.q(0,t,0)]},n).color=new v.c(0,1,0),D.a.CreateLines("axisZ",{points:[v.q.Zero(),new v.q(0,0,t)]},n).color=new v.c(0,0,1)},n.keyDirection=0,n.touching=!0,n.levelHeight=40,n.levelWidth=150,n.levelDepth=4,n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"createCamera",value:function(e,t){var n=new f.a("arc-camera",-Math.PI/2,Math.PI/2,60,new v.q(0,0,0),e);return n.fov=.6,n.minZ=0,n}},{key:"createSky",value:function(e){var t=new B.a("sky-material",e);t.backFaceCulling=!1,t.luminance=.8,t.inclination=.18,t.azimuth=.27,A.a.CreateBox("skybox",{size:1e3},e).material=t}},{key:"createDirectionalLight",value:function(e){var t=new m.a("direct",new v.q(-1,-3,3),e);t.position=new v.q(10,this.levelHeight,-10),this.sg=new k.a(1024,t),this.sg.usePoissonSampling=!0}},{key:"createHemisphericLight",value:function(e){new w.a("hemi",new v.q(1,2,1),e).intensity=.3}},{key:"createLights",value:function(e){var t=new d.a("light",new v.q(3*this.levelWidth/4,9,-200),e),n=new d.a("light",new v.q(3*-this.levelWidth/4,32,-200),e);t.intensity=.7,n.intensity=.3}},{key:"createGround",value:function(e){var t=C.a.CreateGround("land",{width:this.levelWidth,height:this.levelDepth,sideOrientation:L.a.DOUBLESIDE},e);return t.physicsImpostor=new y.a(t,y.a.PlaneImpostor,{mass:0,restitution:0,stiffness:0,friction:1},e),t.visibility=0,t}},{key:"createFloor",value:function(e){var t=this.getBoxWrapUV(this.levelWidth,2,this.levelDepth,5),n=A.a.CreateBox("land",{width:this.levelWidth,height:2,sideOrientation:L.a.DOUBLESIDE,depth:this.levelDepth,faceUV:t},e);n.position.y=-1,n.material=this.concreteMaterial,n.receiveShadows=!0}},{key:"createCeiling",value:function(e){var t=new b.a("default-material",e);t.diffuseColor=new v.c(1,1,1);var n=A.a.CreateBox("ceiling",{width:this.levelWidth,depth:this.levelDepth,height:.2},e);return n.position.y=40,n.material=t,n.physicsImpostor=new y.a(n,y.a.BoxImpostor,{mass:0},e),n}},{key:"createLeftWall",value:function(e){var t=new b.a("default-material",e);t.diffuseColor=new v.c(1,1,1);var n=A.a.CreateBox("leftWall",{width:this.levelHeight,depth:this.levelDepth,height:.2},e);n.rotation.z=Math.PI/2,n.position.y=20,n.position.x=-this.levelWidth/2,n.material=t,n.physicsImpostor=new y.a(n,y.a.BoxImpostor,{mass:0,restitution:.9},e),n.receiveShadows=!0}},{key:"createRightWall",value:function(e){var t=new b.a("default-material",e);t.diffuseColor=new v.c(1,1,1);var n=A.a.CreateBox("rightWall",{width:this.levelHeight,depth:this.levelDepth,height:.2},e);n.rotation.z=Math.PI/2,n.position.y=20,n.position.x=this.levelWidth/2,n.material=t,n.physicsImpostor=new y.a(n,y.a.BoxImpostor,{mass:0,restitution:.9},e),n.receiveShadows=!0}},{key:"createBricksMaterial",value:function(e){var t=new x.a("bricks",e);return t.forceIrradianceInFragment=!0,t.albedoTexture=new M.a("textures/bricks_rustic_albedo.png",e),t.bumpTexture=new M.a("textures/bricks_rustic_normal.png",e),t.useRoughnessFromMetallicTextureAlpha=!1,t.useRoughnessFromMetallicTextureGreen=!0,t.useMetallnessFromMetallicTextureBlue=!0,t.metallicTexture=new M.a("textures/bricks_rustic_metallic_roughness.png",e),t.invertNormalMapX=!0,t.invertNormalMapY=!0,t}},{key:"createBackWall",value:function(e){var t=this;C.a.CreateGroundFromHeightMap("backWall","textures/bricks_rustic_height.png",{height:20,width:20,subdivisions:200,maxHeight:.2,onReady:function(n){n.rotation.x=-Math.PI/2,n.material=t.pbr,n.receiveShadows=!0;for(var i=new L.a("tmpBackWall",e),o=0;o<t.levelWidth;o+=20)for(var r=0;r<t.levelHeight;r+=20)if(0===o&&0===r)n.parent=i,n.position=new v.q(o,r,0);else{var a=n.createInstance("wallTile"+o+"_"+r);a.parent=i,a.position=new v.q(o,r,0)}i.position.z=t.levelDepth/2,i.position.y=t.levelHeight/2-10,i.position.x=-t.levelWidth/2,i.physicsImpostor=new y.a(i,y.a.BoxImpostor,{mass:0,restitution:.1,friction:.01},e)}},e)}},{key:"createFrontWall",value:function(e){var t=W.a.CreatePlane("frontWall",{height:this.levelWidth,width:this.levelHeight,sideOrientation:L.a.BACKSIDE},e);t.rotation.z=Math.PI/2,t.position.z=-this.levelDepth/2,t.position.y=this.levelHeight/2,t.physicsImpostor=new y.a(t,y.a.BoxImpostor,{mass:0,restitution:.1,friction:.01},e)}},{key:"createConcreteMaterial",value:function(e){var t=new x.a("concrete",e);return t.forceIrradianceInFragment=!0,t.albedoTexture=new M.a("textures/concrete_worn_albedo.png",e),t.bumpTexture=new M.a("textures/concrete_worn_normal.png",e),t.useRoughnessFromMetallicTextureAlpha=!1,t.useRoughnessFromMetallicTextureGreen=!0,t.useMetallnessFromMetallicTextureBlue=!0,t.metallicTexture=new M.a("textures/concrete_worn_metallic_roughness.png",e),t.invertNormalMapX=!0,t.invertNormalMapY=!0,t}},{key:"getBoxWrapUV",value:function(e,t,n,i){for(var o=new Array(6),r=0;r<6;r++)0===r||1===r?o[r]=new v.r(0,0,e/i,t/i):2===r||3===r?o[r]=new v.r(0,0,t/i,n/i):4!==r&&5!==r||(o[r]=new v.r(0,0,n/i,e/i));return o}},{key:"createPlatform",value:function(e){var t=this.getBoxWrapUV(20,2,this.levelDepth,5),n=A.a.CreateBox("ceiling",{width:20,depth:this.levelDepth,height:2,faceUV:t},e);return n.position.y=10,n.material=this.concreteMaterial,n.physicsImpostor=new y.a(n,y.a.BoxImpostor,{mass:0,restitution:.1,friction:.01},e),this.sg.getShadowMap().renderList.push(n),n.receiveShadows=!0,n}},{key:"createEgg",value:function(e){var t=new b.a("default-material",e);t.diffuseColor=new v.c(1,1,1);var n=S.a.CreateSphere("egg",{diameter:1.5,segments:16},e);return n.material=t,n.position.y=15,this.sg.getShadowMap().renderList.push(n),n}},{key:"rotatePlayer",value:function(e,t){if(console.log(e),0===e)this.model.rotationQuaternion=t;else{var n=new v.q(0,1,0),i=e*(Math.PI/2)-Math.PI/2,o=v.j.RotationAxis(n,i);this.model.rotationQuaternion=o}}},{key:"loadModels",value:function(e){var t=this;this.assetsNum=4,I.a.ImportMesh("walking_left","models/","walking_left.babylon",e,(function(e){t.walkingLeft=e[0],t.checkAssets(t.walkingLeft)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),I.a.ImportMesh("flying","models/","flying.babylon",e,(function(e){t.flying=e[0],t.checkAssets(t.flying)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),I.a.ImportMesh("running","models/","running.babylon",e,(function(e){t.running=e[0],t.checkAssets(t.running)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),I.a.ImportMesh("flapping","models/","flapping.babylon",e,(function(e){t.flapping=e[0],t.checkAssets(t.flapping)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)}))}},{key:"checkAssets",value:function(e){e.visibility=0,e.position.x=5*this.assetsNum,e.position.y=3.3,this.sg.getShadowMap().renderList.push(e),this.assetsNum--,0===this.assetsNum&&console.log("checkAssets finish")}},{key:"changeModel",value:function(e){if(e!==this.model){this.model.parent=null,this.model.visibility=0,e.visibility=1;var t=this.model.rotationQuaternion;this.model=e,this.player.addChild(e),e.position=new v.q(0,.3,0),this.rotatePlayer(this.keyDirection,t)}}},{key:"createSphere",value:function(e){var t=this,n=A.a.CreateBox("sphere",{width:4,height:6.1,depth:2},e);n.visibility=0;I.a.ImportMesh("walking","models/","walking.babylon",e,(function(i){var o=i[0];o.receiveShadows=!0,o.position.y=.3,t.walking=t.model=o,n.addChild(o),n.position.y=3,n.physicsImpostor=new y.a(n,y.a.SphereImpostor,{mass:.2,restitution:0,friction:1,stiffness:0},e),n.physicsImpostor.registerOnPhysicsCollide([t.platform.physicsImpostor,t.land.physicsImpostor],t.onSphereHitGround),t.sg.getShadowMap().renderList.push(o),t.setEggImpostor()}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)}));return this.camera.parent=n,n}},{key:"setEggImpostor",value:function(e){this.egg.physicsImpostor=new y.a(this.egg,y.a.SphereImpostor,{mass:1,restitution:.2,friction:.3},this.scene),this.player.physicsImpostor.registerOnPhysicsCollide(this.egg.physicsImpostor,this.onSphereHitEgg)}},{key:"getBoost",value:function(){var e=this.player.physicsImpostor.getLinearVelocity().x;return e/Math.abs(e)===this.keyDirection?1:2}},{key:"isNotSpeeding",value:function(){return this.player.physicsImpostor.getLinearVelocity().x*this.keyDirection<7}},{key:"isTouchingGround",value:function(){return this.touching}},{key:"accelerate",value:function(){if(this.resetPosAndAngle(),0!==this.keyDirection&&this.isNotSpeeding()&&this.isTouchingGround()){var e=this.getBoost();this.player.physicsImpostor.applyImpulse(new v.q(1*this.keyDirection*e,0,0),this.player.getAbsolutePosition())}}},{key:"render",value:function(){return o.a.createElement(_,{onSceneMount:this.onSceneMount,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onRender:this.resetPosAndAngle})}}]),t}(o.a.Component),H=function(){return o.a.createElement(T,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[125,1,2]]]);
//# sourceMappingURL=main.609a007d.chunk.js.map