(this.webpackJsonpjoust=this.webpackJsonpjoust||[]).push([[0],{124:function(e,t,i){e.exports=i(136)},129:function(e,t,i){},130:function(e,t,i){e.exports=i.p+"static/media/logo.25bf045c.svg"},131:function(e,t,i){},136:function(e,t,i){"use strict";i.r(t);var n=i(42),o=i.n(n),s=i(114),a=i.n(s),r=(i(129),i(130),i(131),i(80)),l=i(81),c=i(86),h=i(82),p=i(87),u=i(83),y=i(17),g=i(0),v=i(121),f=i(115),m=i(116),d=(i(132),i(117)),w=i(62),k=(i(133),i(65)),I=i(122),M=i(97),P=(i(137),i(12)),x=i(63),b=i(118),D=i(98),W=i(119),L=i(52),B=i(15),C=i(123),S=(i(113),i(134),i(14)),q=i(23),A=(i(135),i(120)),H=i.n(A);window.earcut=H.a;var F=function(e){function t(){var e,i;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(i=Object(c.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).onResizeWindow=function(){i.engine&&i.engine.resize()},i.onCanvasLoaded=function(e){if(null!==e){i.canvas=e;var t=function(e){return e.preventDefault()};i.canvas.onwheel=t,i.canvas.onmousewheel=t,i.canvas.focus()}},i.onKeyDown=function(e){i.props.onKeyDown(e)},i.onKeyUp=function(e){i.props.onKeyUp(e)},i}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.engine=new S.a(this.canvas,this.props.antialias,this.props.engineOptions,this.props.adaptToDeviceRatio),this.scene=new q.a(this.engine),this.props.onSceneMount({scene:this.scene,engine:this.engine,canvas:this.canvas}),this.engine.runRenderLoop((function(){e.scene&&(e.props.onRender(),e.scene.render())})),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow)}},{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.onCanvasLoaded,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,style:{width:"100%",height:"100%",outline:"none"}})}}]),t}(o.a.Component);F.defaultProps={antialias:!0,adaptToDeviceRatio:!1};var V=F,E=!1,U=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(c.a)(this,Object(h.a)(t).call(this,e))).onSceneMount=function(e){var t=e.canvas,n=e.scene;e.engine;window.scene=n,i.scene=n;var o=new g.q(0,-9.81,0),s=new u.a;n.enablePhysics(o,s),i.camera=i.createCamera(n,t),i.createLights(n),i.createDirectionalLight(n),i.createHemisphericLight(n),i.createStaticMesh(n),E&&i.showWorldAxis({size:5,scene:n})},i.onPlayerHitEgg=function(e,t){i.egg.physicsImpostor.dispose(),i.egg.parent=i.player,i.egg.position=new g.q(1.75,0,0)},i.onPlayerHitGround=function(e,t){e.object.position.y>t.object.position.y&&i.changePlayerModel(i.walking),Math.abs(i.player.physicsImpostor.getLinearVelocity().y)<4&&(i.touching=!0)},i.onSpacePressed=function(){i.changePlayerModel(i.flapping),i.resetPlayerVelocity(),i.sendPlayerFlapImpulse(),i.touching=!1},i.onKeyDown=function(e){e.preventDefault()," "===e.key?i.onSpacePressed():"ArrowRight"===e.key?(i.keyDirection=1,i.rotatePlayer(i.keyDirection),i.setLowPlayerFriction(),i.startPlayerMoveInterval()):"ArrowLeft"===e.key?(i.keyDirection=-1,i.rotatePlayer(i.keyDirection),i.setLowPlayerFriction(),i.startPlayerMoveInterval()):"AltGraph"===e.key&&i.playerHasEgg()&&(console.log("AltGraph"),i.launchEgg())},i.onKeyUp=function(e){e.preventDefault(),"ArrowRight"===e.key||"ArrowLeft"===e.key?(i.keyDirection=0,i.endPlayerMoveInterval(),i.setHighPlayerFriction()):" "===e.key&&i.changePlayerModel(i.flying)},i.resetPlayerVelocity=function(){if(i.player&&i.player.physicsImpostor){var e=i.player.physicsImpostor.getLinearVelocity();e.z=0,i.player.physicsImpostor.setLinearVelocity(e),i.player.physicsImpostor.setAngularVelocity(new g.q(0,0,0)),i.player.rotation=new g.q(0,0,0)}},i.showWorldAxis=function(e){var t=e.size,i=e.scene;x.a.CreateLines("axisX",{points:[g.q.Zero(),new g.q(t,0,0)]},i).color=new g.c(1,0,0),x.a.CreateLines("axisY",{points:[g.q.Zero(),new g.q(0,t,0)]},i).color=new g.c(0,1,0),x.a.CreateLines("axisZ",{points:[g.q.Zero(),new g.q(0,0,t)]},i).color=new g.c(0,0,1)},i.keyDirection=0,i.touching=!0,i.levelHeight=40,i.levelWidth=150,i.levelDepth=4,i}return Object(p.a)(t,e),Object(l.a)(t,[{key:"createCamera",value:function(e,t){var i=new v.a("arc-camera",-Math.PI/2,Math.PI/2,60,new g.q(0,0,0),e);return i.fov=.6,i.minZ=0,i}},{key:"createSky",value:function(e){var t=new C.a("sky-material",e);t.backFaceCulling=!1,t.luminance=1,t.inclination=.3,t.azimuth=.4,L.a.CreateBox("skybox",{size:1e3},e).material=t}},{key:"createDirectionalLight",value:function(e){var t=new f.a("direct",new g.q(-1,-3,3),e);t.intensity=2.5,t.position=new g.q(10,this.levelHeight,-10),this.sg=new w.a(1024,t),this.sg.usePoissonSampling=!0}},{key:"createHemisphericLight",value:function(e){new d.a("hemi",new g.q(0,0,-1),e).intensity=.15}},{key:"createLights",value:function(e){this.flickers=new Map;for(var t=1;t<=2;t++){var i=new m.a("pointlight"+t,new g.q(this.levelWidth*t/2-3*this.levelWidth/4,this.levelHeight/2,this.levelDepth/2-1.5),new g.q(0,1,.3),Math.PI,10,e);console.log(i),this.ssg=new w.a(512,i),this.ssg.usePoissonSampling=!0,i.diffuse=new g.c(1,.4,.2),i.intensity=500,this.startLightFlicker(i)}}},{key:"startLightFlicker",value:function(e){var t=this;this.flickers[e]={interval:setInterval((function(){return t.flickerLight(e)}),50),position:e.position.clone()}}},{key:"flickerLight",value:function(e){var t=Date.now(),i=t*Math.PI/600,n=t*Math.PI/400,o=t*Math.PI/100;e.intensity=400+50*Math.cos(o),e.position.x=this.flickers[e].position.x+Math.cos(i)/8,e.position.z=this.flickers[e].position.z-Math.sin(n)/8}},{key:"createStaticMesh",value:function(e){this.loadModels(e),this.concreteMaterial=this.createConcreteMaterial(e),this.pbr=this.createBricksMaterial(e),this.land=this.createGround(e),this.createFloor(e),this.ceiling=this.createCeiling(e),this.createLeftWall(e),this.createRightWall(e),this.createBackWall(e),this.createFrontWall(e),this.platform=this.createPlatform(e),this.egg=this.createEgg(e),this.player=this.createPlayer(e)}},{key:"createGround",value:function(e){var t=D.a.CreateGround("land",{width:this.levelWidth,height:this.levelDepth,sideOrientation:B.a.DOUBLESIDE},e);return t.physicsImpostor=new y.a(t,y.a.PlaneImpostor,{mass:0,restitution:0,stiffness:0,friction:1},e),t.visibility=0,t}},{key:"createFloor",value:function(e){var t=this.getBoxWrapUV(this.levelWidth,2,this.levelDepth,5),i=L.a.CreateBox("land",{width:this.levelWidth,height:2,depth:this.levelDepth,sideOrientation:B.a.DOUBLESIDE,faceUV:t},e);i.position.y=-1,i.material=this.concreteMaterial,i.receiveShadows=!0}},{key:"createCeiling",value:function(e){var t=this.getBoxWrapUV(this.levelWidth,2,this.levelDepth,5),i=L.a.CreateBox("ceiling",{width:this.levelWidth,depth:this.levelDepth,height:2,faceUV:t},e);return i.position.y=41,i.material=this.concreteMaterial,i.physicsImpostor=new y.a(i,y.a.BoxImpostor,{mass:0},e),i}},{key:"createLeftWall",value:function(e){var t=this.getBoxWrapUV(2,this.levelHeight,this.levelDepth,5),i=L.a.CreateBox("leftWall",{width:2,depth:this.levelDepth,height:this.levelHeight,faceUV:t},e);i.position.y=this.levelHeight/2,i.position.x=-this.levelWidth/2+1,i.material=this.concreteMaterial,i.physicsImpostor=new y.a(i,y.a.BoxImpostor,{mass:0,restitution:.9},e),i.receiveShadows=!0}},{key:"createRightWall",value:function(e){var t=this.getBoxWrapUV(2,this.levelHeight,this.levelDepth,5),i=L.a.CreateBox("rightWall",{width:2,depth:this.levelDepth,height:this.levelHeight,faceUV:t},e);i.position.y=this.levelHeight/2,i.position.x=this.levelWidth/2-1,i.material=this.concreteMaterial,i.physicsImpostor=new y.a(i,y.a.BoxImpostor,{mass:0,restitution:.9},e),i.receiveShadows=!0}},{key:"createBricksMaterial",value:function(e){var t=new M.a("bricks",e);return t.forceIrradianceInFragment=!0,t.albedoTexture=new P.a("textures/bricks_rustic_albedo.png",e),t.bumpTexture=new P.a("textures/bricks_rustic_normal.png",e),t.useRoughnessFromMetallicTextureAlpha=!1,t.useRoughnessFromMetallicTextureGreen=!0,t.useMetallnessFromMetallicTextureBlue=!0,t.metallicTexture=new P.a("textures/bricks_rustic_metallic_roughness.png",e),t.invertNormalMapX=!0,t.invertNormalMapY=!0,t}},{key:"createBackWall",value:function(e){var t=this;D.a.CreateGroundFromHeightMap("backWall","textures/bricks_rustic_height.png",{height:20,width:20,subdivisions:200,maxHeight:.2,onReady:function(i){i.rotation.x=-Math.PI/2,i.material=t.pbr,i.receiveShadows=!0;var n=t.createBackWallGrid(i,e,20,20);n.position.z=t.levelDepth/2,n.position.y=t.levelHeight/2-10,n.position.x=-t.levelWidth/2,n.physicsImpostor=new y.a(n,y.a.BoxImpostor,{mass:0,restitution:.1,friction:.01},e)}},e)}},{key:"createBackWallGrid",value:function(e,t,i,n){for(var o=new B.a("tmpBackWall",t),s=0;s<this.levelWidth;s+=i)for(var a=0;a<this.levelHeight;a+=n)if(0===s&&0===a)e.parent=o,e.position=new g.q(s,a,0);else{var r=e.createInstance("wallTile"+s+"_"+a);r.parent=o,r.position=new g.q(s,a,0)}return o}},{key:"createFrontWall",value:function(e){var t=b.a.CreatePlane("frontWall",{height:this.levelWidth,width:this.levelHeight},e);t.visibility=0,t.rotation.z=Math.PI/2,t.position.z=-this.levelDepth/2,t.position.y=this.levelHeight/2}},{key:"createConcreteMaterial",value:function(e){var t=new M.a("concrete",e);return t.forceIrradianceInFragment=!0,t.albedoTexture=new P.a("textures/concrete_worn_albedo.png",e),t.bumpTexture=new P.a("textures/concrete_worn_normal.png",e),t.useRoughnessFromMetallicTextureAlpha=!1,t.useRoughnessFromMetallicTextureGreen=!0,t.useMetallnessFromMetallicTextureBlue=!0,t.metallicTexture=new P.a("textures/concrete_worn_metallic_roughness.png",e),t.invertNormalMapX=!0,t.invertNormalMapY=!0,t}},{key:"getBoxWrapUV",value:function(e,t,i,n){for(var o=new Array(6),s=0;s<6;s++)0===s||1===s?o[s]=new g.r(0,0,e/n,t/n):2===s||3===s?o[s]=new g.r(0,0,t/n,i/n):4!==s&&5!==s||(o[s]=new g.r(0,0,i/n,e/n));return o}},{key:"createPlatform",value:function(e){var t=this.getBoxWrapUV(20,2,this.levelDepth,5),i=L.a.CreateBox("ceiling",{width:20,depth:this.levelDepth,height:2,faceUV:t},e);return i.position.y=10,i.material=this.concreteMaterial,i.physicsImpostor=new y.a(i,y.a.BoxImpostor,{mass:0,restitution:.1,friction:.01},e),this.sg.getShadowMap().renderList.push(i),i.receiveShadows=!0,i}},{key:"createEgg",value:function(e){var t=new I.a("default-material",e);t.diffuseColor=new g.c(1,1,1);var i=W.a.CreateSphere("egg",{diameter:1.5,segments:16},e);return i.material=t,i.position.y=15,this.sg.getShadowMap().renderList.push(i),i}},{key:"rotatePlayer",value:function(e,t){if(console.log(e),0===e)this.model.rotationQuaternion=t;else{var i=new g.q(0,1,0),n=e*(Math.PI/2)-Math.PI/2,o=g.j.RotationAxis(i,n);this.model.rotationQuaternion=o}}},{key:"loadModels",value:function(e){var t=this;this.assetsNum=4,k.a.ImportMesh("walking_left","models/","walking_left.babylon",e,(function(e){t.walkingLeft=e[0],t.checkAssets(t.walkingLeft)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),k.a.ImportMesh("flying","models/","flying.babylon",e,(function(e){t.flying=e[0],t.checkAssets(t.flying)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),k.a.ImportMesh("running","models/","running.babylon",e,(function(e){t.running=e[0],t.checkAssets(t.running)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)})),k.a.ImportMesh("flapping","models/","flapping.babylon",e,(function(e){t.flapping=e[0],t.checkAssets(t.flapping)}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)}))}},{key:"checkAssets",value:function(e){e.visibility=0,e.position.x=5*this.assetsNum,e.position.y=3.3,this.sg.getShadowMap().renderList.push(e),this.assetsNum--,0===this.assetsNum&&console.log("checkAssets finish")}},{key:"changePlayerModel",value:function(e){if(e!==this.model){this.model.parent=null,this.model.visibility=0,e.visibility=1;var t=this.model.rotationQuaternion;this.model=e,this.player.addChild(e),e.position=new g.q(0,.3,0),this.rotatePlayer(this.keyDirection,t)}}},{key:"createPlayer",value:function(e){var t=this,i=L.a.CreateBox("player",{width:4,height:6.1,depth:2},e);i.visibility=0;k.a.ImportMesh("walking","models/","walking.babylon",e,(function(n){var o=n[0];o.receiveShadows=!0,o.position.y=.3,t.walking=t.model=o,i.addChild(o),i.position.y=3,i.position.z=0,i.physicsImpostor=new y.a(i,y.a.SphereImpostor,{mass:.2,restitution:0,friction:1,stiffness:0},e),i.physicsImpostor.registerOnPhysicsCollide([t.platform.physicsImpostor,t.land.physicsImpostor],t.onPlayerHitGround),t.sg.getShadowMap().renderList.push(o),t.setEggImpostor()}),(function(e){return console.log("progress"+e)}),(function(e,t){return console.log("error"+t)}));return this.attachCameraToPlayer(i),i}},{key:"attachCameraToPlayer",value:function(e){this.player&&(e=this.player),this.camera.parent=e,this.camera.position.y=3}},{key:"setEggImpostor",value:function(e){this.egg.physicsImpostor=new y.a(this.egg,y.a.SphereImpostor,{mass:1,restitution:.2,friction:.3},this.scene),this.player.physicsImpostor.registerOnPhysicsCollide(this.egg.physicsImpostor,this.onPlayerHitEgg)}},{key:"sendPlayerFlapImpulse",value:function(){var e=this.getBoost();console.log("sendPlayerFlapImpulse boost"+e),this.player.physicsImpostor.applyImpulse(new g.q(.6*this.keyDirection*e,.8,0),this.player.getAbsolutePosition())}},{key:"getBoost",value:function(){var e=this.player.physicsImpostor.getLinearVelocity().x;return e/Math.abs(e)===this.keyDirection?1:2}},{key:"isNotSpeeding",value:function(){return this.player.physicsImpostor.getLinearVelocity().x*this.keyDirection<7}},{key:"isTouchingGround",value:function(){return this.touching}},{key:"setLowPlayerFriction",value:function(){this.player.physicsImpostor.friction=.1,this.land.physicsImpostor.friction=.1}},{key:"setHighPlayerFriction",value:function(){this.player.physicsImpostor.friction=1,this.land.physicsImpostor.friction=1}},{key:"startPlayerMoveInterval",value:function(){if(!this.accelerateInterval){var e=this;this.accelerateInterval=setInterval((function(){e.accelerate.apply(e)}),200)}}},{key:"endPlayerMoveInterval",value:function(){this.accelerateInterval&&(console.log("clearInterval"),clearInterval(this.accelerateInterval),this.accelerateInterval=null)}},{key:"playerHasEgg",value:function(){return this.player.getChildren().includes(this.egg)}},{key:"launchEgg",value:function(){this.egg.parent=null,this.egg.position=this.player.getAbsolutePosition(),this.egg.position.x+=5*this.keyDirection,this.setEggImpostor(),this.egg.position.z=0;var e=this.egg.physicsImpostor.getLinearVelocity();e.z=0,this.egg.physicsImpostor.setLinearVelocity(e),this.egg.physicsImpostor.setAngularVelocity(new g.q(0,0,0)),this.egg.rotation=new g.q(0,0,0),this.egg.physicsImpostor.applyImpulse(new g.q(20*this.keyDirection,0,0),this.egg.getAbsolutePosition())}},{key:"accelerate",value:function(){this.resetPlayerVelocity(),0!==this.keyDirection&&this.isNotSpeeding()&&this.isTouchingGround()&&this.sendPlayerStepImpulse()}},{key:"sendPlayerStepImpulse",value:function(){var e=this.getBoost();this.player.physicsImpostor.applyImpulse(new g.q(1*this.keyDirection*e,0,0),this.player.getAbsolutePosition())}},{key:"render",value:function(){return o.a.createElement(V,{onSceneMount:this.onSceneMount,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onRender:this.resetPlayerVelocity})}}]),t}(o.a.Component),z=function(){return o.a.createElement(U,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[124,1,2]]]);
//# sourceMappingURL=main.87dd7b62.chunk.js.map